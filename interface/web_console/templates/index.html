<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PEPPERæ™ºèƒ½æ•™å­¦ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            color: #2f3542;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: #f8f9ff;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .nav-tab:hover {
            background: #f8f9ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #2f3542;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #57606f;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #a4b0be;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: #57606f;
        }

        .btn-success {
            background: #2ed573;
        }

        .btn-danger {
            background: #ff4757;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .status-online {
            background: #d4edcf;
            color: #2ed573;
        }

        .status-offline {
            background: #ffd3d8;
            color: #ff4757;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .chat-container {
            height: 400px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9ff;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
        }

        .chat-user {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        .chat-assistant {
            background: white;
            border: 1px solid #e1e5e9;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e1e5e9;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .file-upload {
            border: 2px dashed #e1e5e9;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .log-container {
            background: #2f3542;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .form-row {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PEPPERæ™ºèƒ½æ•™å­¦ç³»ç»Ÿ</h1>
            <p>åŸºäºDeepSeekæ¨¡å‹çš„ä¸ªæ€§åŒ–AIæ•™å­¦åŠ©æ‰‹</p>
        </div>

        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('llm')">ğŸ§  å¤§è¯­è¨€æ¨¡å‹</button>
            <button class="nav-tab" onclick="showTab('knowledge')">ğŸ—‚ï¸ çŸ¥è¯†å›¾è°±</button>
            <button class="nav-tab" onclick="showTab('multimodal')">ğŸ¯ å¤šæ¨¡æ€äº¤äº’</button>
            <button class="nav-tab" onclick="showTab('teaching')">ğŸ“š æ™ºèƒ½æ•™å­¦</button>
        </div>

        <!-- å¤§è¯­è¨€æ¨¡å‹æ ‡ç­¾é¡µ -->
        <div id="llm" class="tab-content active">
            <div class="grid-2">
                <div class="panel">
                    <h2>DeepSeekæ¨¡å‹ç®¡ç†</h2>
                    <div class="form-group">
                        <label>æ¨¡å‹çŠ¶æ€</label>
                        <div class="status-indicator status-offline" id="model-status">
                            â— æ¨¡å‹æœªåŠ è½½
                        </div>
                    </div>

                    <!-- æ–°å¢ï¼šæ¨¡å‹å‘ç°å’Œé€‰æ‹© -->
                    <div class="form-group">
                        <label>æ¨¡å‹é€‰æ‹©</label>

                        <!-- æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: nowrap;">
                            <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal; white-space: nowrap;">
                                <input type="radio" name="model-mode" value="auto" checked onchange="toggleModelMode()" style="margin-right: 8px;">
                                <span>ğŸ¯ è‡ªåŠ¨å‘ç°</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal; white-space: nowrap;">
                                <input type="radio" name="model-mode" value="manual" onchange="toggleModelMode()" style="margin-right: 8px;">
                                <span>âœï¸ æ‰‹åŠ¨è¾“å…¥</span>
                            </label>
                        </div>

                        <!-- è‡ªåŠ¨å‘ç°æ¨¡å¼ -->
                        <div id="auto-model-section">
                            <div class="model-selector-container">
                                <select id="model-selector" class="model-select">
                                    <option value="">ğŸ” é€‰æ‹©ä¸€ä¸ªæ¨¡å‹...</option>
                                </select>
                                <button class="btn-scan" onclick="discoverModels()">
                                    <span class="scan-icon">ğŸ”„</span>
                                    <span class="scan-text">æ‰«æ</span>
                                </button>
                            </div>
                            <div id="model-scan-status" class="scan-status">
                                ç‚¹å‡»"æ‰«æ"æ¥å‘ç°å¯ç”¨çš„æ¨¡å‹
                            </div>
                        </div>

                        <!-- æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ -->
                        <div id="manual-model-section" style="display: none;">
                            <input type="text" id="model-path" class="manual-path-input"
                                   value="models/deepseek-coder-1.3b-base"
                                   placeholder="è¾“å…¥æ¨¡å‹è·¯å¾„ï¼Œä¾‹å¦‚ï¼šmodels/deepseek-coder-1.3b-base">
                        </div>
                    </div>

                    <!-- æ¨¡å‹è¯¦ç»†ä¿¡æ¯å±•ç¤º -->
                    <div id="model-details" style="display: none; background: #f8f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>æ¨¡å‹ä¿¡æ¯</strong>
                                <ul id="model-basic-info" style="margin: 5px 0; padding-left: 20px;">
                                </ul>
                            </div>
                            <div>
                                <strong>æ–‡ä»¶ç»Ÿè®¡</strong>
                                <ul id="model-file-stats" style="margin: 5px 0; padding-left: 20px;">
                                </ul>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>æ–‡ä»¶åˆ—è¡¨</strong>
                            <div id="model-files-list" style="max-height: 150px; overflow-y: auto; background: white; padding: 10px; border-radius: 4px; margin-top: 5px;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button onclick="loadModel()" id="load-model-btn">åŠ è½½æ¨¡å‹</button>
                        <button class="btn-secondary" onclick="unloadModel()">å¸è½½æ¨¡å‹</button>
                        <button class="btn-secondary" onclick="showModelInfo()" id="info-model-btn">æ¨¡å‹ä¿¡æ¯</button>
                    </div>

                    <h2>LoRAå¾®è°ƒ</h2>
                    <div class="form-group">
                        <label>è®­ç»ƒæ•°æ®æ–‡ä»¶</label>
                        <div class="file-upload" onclick="document.getElementById('training-data').click()">
                            <input type="file" id="training-data" accept=".json,.csv" style="display: none;">
                            <p>ç‚¹å‡»ä¸Šä¼ è®­ç»ƒæ•°æ®</p>
                            <small>æ”¯æŒJSON/CSVæ ¼å¼</small>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>è®­ç»ƒè½®æ•°</label>
                            <input type="number" id="epochs" value="3" min="1" max="10">
                        </div>
                        <div class="form-group">
                            <label>å­¦ä¹ ç‡</label>
                            <input type="number" id="learning-rate" value="0.0002" step="0.0001">
                        </div>
                    </div>
                    <div class="form-group">
                        <button onclick="startFineTuning()">å¼€å§‹å¾®è°ƒ</button>
                    </div>
                    <div class="form-group">
                        <label>è®­ç»ƒè¿›åº¦</label>
                        <div class="progress-bar">
                            <div class="progress-fill" id="training-progress" style="width: 0%"></div>
                        </div>
                        <span id="progress-text">0%</span>
                    </div>
                </div>

                <div class="panel">
                    <h2>æ¨¡å‹æµ‹è¯•</h2>
                    <div class="form-group">
                        <label>æµ‹è¯•é—®é¢˜</label>
                        <textarea id="test-question" rows="3" placeholder="è¾“å…¥æµ‹è¯•é—®é¢˜..."></textarea>
                    </div>
                    <div class="form-group">
                        <button onclick="testModel()">æµ‹è¯•æ¨¡å‹</button>
                    </div>
                    <div class="form-group">
                        <label>æ¨¡å‹å›ç­”</label>
                        <div id="model-response" style="background: #f8f9ff; padding: 15px; border-radius: 8px; min-height: 100px;">
                            ç­‰å¾…æµ‹è¯•...
                        </div>
                    </div>

                    <h2>æ¨¡å‹å‚æ•°</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Temperature</label>
                            <input type="range" id="temperature" min="0.1" max="2.0" step="0.1" value="0.7">
                            <span id="temp-value">0.7</span>
                        </div>
                        <div class="form-group">
                            <label>Max Tokens</label>
                            <input type="number" id="max-tokens" value="512" min="50" max="2048">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŸ¥è¯†å›¾è°±æ ‡ç­¾é¡µ -->
        <div id="knowledge" class="tab-content">
            <div class="grid-2">
                <div class="panel">
                    <h2>Neo4jæ•°æ®åº“è¿æ¥</h2>
                    <div class="form-group">
                        <label>è¿æ¥çŠ¶æ€</label>
                        <div class="status-indicator status-offline" id="neo4j-status">
                            â— æ•°æ®åº“æœªè¿æ¥
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>æœåŠ¡å™¨åœ°å€</label>
                            <input type="text" id="neo4j-uri" value="bolt://localhost:7687">
                        </div>
                        <div class="form-group">
                            <label>ç”¨æˆ·å</label>
                            <input type="text" id="neo4j-user" value="neo4j">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="neo4j-password" value="admin123">
                    </div>
                    <div class="form-group">
                        <button onclick="connectNeo4j()">è¿æ¥æ•°æ®åº“</button>
                        <button class="btn-secondary" onclick="disconnectNeo4j()">æ–­å¼€è¿æ¥</button>
                    </div>

                    <h2>çŸ¥è¯†å¯¼å…¥</h2>
                    <div class="form-group">
                        <label>çŸ¥è¯†æ–‡ä»¶</label>
                        <div class="file-upload" onclick="document.getElementById('knowledge-file').click()">
                            <input type="file" id="knowledge-file" accept=".json,.csv,.txt" style="display: none;">
                            <p>ç‚¹å‡»ä¸Šä¼ çŸ¥è¯†æ–‡ä»¶</p>
                            <small>æ”¯æŒJSON/CSV/TXTæ ¼å¼</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <button onclick="importKnowledge()">å¯¼å…¥çŸ¥è¯†</button>
                        <button class="btn-success" onclick="generateSampleKnowledge()">ç”Ÿæˆç¤ºä¾‹çŸ¥è¯†</button>
                    </div>
                </div>

                <div class="panel">
                    <h2>çŸ¥è¯†æŸ¥è¯¢</h2>
                    <div class="form-group">
                        <label>CypheræŸ¥è¯¢</label>
                        <textarea id="cypher-query" rows="4" placeholder="MATCH (n) RETURN n LIMIT 10"></textarea>
                    </div>
                    <div class="form-group">
                        <button onclick="executeCypher()">æ‰§è¡ŒæŸ¥è¯¢</button>
                        <button class="btn-secondary" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
                    </div>
                    <div class="form-group">
                        <label>æŸ¥è¯¢ç»“æœ</label>
                        <div id="query-results" style="background: #f8f9ff; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto;">
                            ç­‰å¾…æŸ¥è¯¢...
                        </div>
                    </div>

                    <h2>çŸ¥è¯†ç»Ÿè®¡</h2>
                    <div class="grid-3">
                        <div class="card">
                            <h3>èŠ‚ç‚¹æ€»æ•°</h3>
                            <p id="node-count">--</p>
                        </div>
                        <div class="card">
                            <h3>å…³ç³»æ€»æ•°</h3>
                            <p id="relation-count">--</p>
                        </div>
                        <div class="card">
                            <h3>çŸ¥è¯†åŸŸæ•°</h3>
                            <p id="domain-count">--</p>
                        </div>
                    </div>
                    <button onclick="updateStats()">æ›´æ–°ç»Ÿè®¡</button>
                </div>
            </div>
        </div>

        <!-- å¤šæ¨¡æ€äº¤äº’æ ‡ç­¾é¡µ -->
        <div id="multimodal" class="tab-content">
            <div class="grid-3">
                <div class="panel">
                    <h2>è¯­éŸ³è¯†åˆ«</h2>
                    <div class="form-group">
                        <label>è¯†åˆ«çŠ¶æ€</label>
                        <div class="status-indicator status-offline" id="speech-status">
                            â— è¯­éŸ³è¯†åˆ«æœªå¯åŠ¨
                        </div>
                    </div>
                    <div class="form-group">
                        <label>éŸ³é¢‘æ–‡ä»¶</label>
                        <input type="file" id="audio-file" accept=".wav,.mp3,.m4a">
                    </div>
                    <div class="form-group">
                        <button onclick="startRecording()" id="record-btn">ğŸ¤ å¼€å§‹å½•éŸ³</button>
                        <button class="btn-secondary" onclick="uploadAudio()">ä¸Šä¼ éŸ³é¢‘</button>
                    </div>
                    <div class="form-group">
                        <label>è¯†åˆ«ç»“æœ</label>
                        <div id="speech-result" style="background: #f8f9ff; padding: 15px; border-radius: 8px; min-height: 80px;">
                            ç­‰å¾…è¯­éŸ³è¾“å…¥...
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h2>å›¾åƒè¯†åˆ«</h2>
                    <div class="form-group">
                        <label>å›¾åƒæ–‡ä»¶</label>
                        <div class="file-upload" onclick="document.getElementById('image-file').click()">
                            <input type="file" id="image-file" accept=".jpg,.jpeg,.png,.gif" style="display: none;">
                            <p>ç‚¹å‡»ä¸Šä¼ å›¾åƒ</p>
                            <small>æ”¯æŒJPG/PNG/GIFæ ¼å¼</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <img id="preview-image" style="max-width: 100%; max-height: 200px; display: none; border-radius: 8px;">
                    </div>
                    <div class="form-group">
                        <button onclick="recognizeImage()">è¯†åˆ«å›¾åƒ</button>
                    </div>
                    <div class="form-group">
                        <label>è¯†åˆ«ç»“æœ</label>
                        <div id="image-result" style="background: #f8f9ff; padding: 15px; border-radius: 8px; min-height: 80px;">
                            ç­‰å¾…å›¾åƒä¸Šä¼ ...
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h2>æ–‡æœ¬å¤„ç†</h2>
                    <div class="form-group">
                        <label>è¾“å…¥æ–‡æœ¬</label>
                        <textarea id="text-input" rows="6" placeholder="è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬..."></textarea>
                    </div>
                    <div class="form-group">
                        <button onclick="processText()">å¤„ç†æ–‡æœ¬</button>
                        <button class="btn-secondary" onclick="extractKeywords()">æå–å…³é”®è¯</button>
                    </div>
                    <div class="form-group">
                        <label>å¤„ç†ç»“æœ</label>
                        <div id="text-result" style="background: #f8f9ff; padding: 15px; border-radius: 8px; min-height: 100px;">
                            <div><strong>åˆ†è¯ç»“æœ:</strong> <span id="tokens">--</span></div>
                            <div><strong>å…³é”®è¯:</strong> <span id="keywords">--</span></div>
                            <div><strong>é—®é¢˜ç±»å‹:</strong> <span id="question-type">--</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ™ºèƒ½æ•™å­¦æ ‡ç­¾é¡µ -->
        <div id="teaching" class="tab-content">
            <div class="grid-2">
                <div class="panel">
                    <h2>å­¦ç”Ÿç®¡ç†</h2>
                    <div class="form-group">
                        <label>é€‰æ‹©å­¦ç”Ÿ</label>
                        <select id="student-select">
                            <option value="">é€‰æ‹©å­¦ç”Ÿ...</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å­¦ç”Ÿå§“å</label>
                            <input type="text" id="student-name" placeholder="è¾“å…¥å­¦ç”Ÿå§“å">
                        </div>
                        <div class="form-group">
                            <label>å­¦ä¹ é£æ ¼</label>
                            <select id="learning-style">
                                <option value="visual">è§†è§‰å‹</option>
                                <option value="auditory">å¬è§‰å‹</option>
                                <option value="reading">é˜…è¯»å‹</option>
                                <option value="kinesthetic">åŠ¨æ‰‹å‹</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <button onclick="addStudent()">æ·»åŠ å­¦ç”Ÿ</button>
                        <button class="btn-secondary" onclick="loadStudentProfile()">åŠ è½½æ¡£æ¡ˆ</button>
                    </div>

                    <h2>å­¦ä¹ è·¯å¾„ç”Ÿæˆ</h2>
                    <div class="form-group">
                        <label>ç›®æ ‡ä¸»é¢˜</label>
                        <input type="text" id="learning-goal" placeholder="ä¾‹å¦‚ï¼šPythonå¾ªç¯è¯­å¥">
                    </div>
                    <div class="form-group">
                        <button onclick="generateLearningPath()">ç”Ÿæˆå­¦ä¹ è·¯å¾„</button>
                    </div>
                    <div class="form-group">
                        <label>å­¦ä¹ è·¯å¾„</label>
                        <div id="learning-path" style="background: #f8f9ff; padding: 15px; border-radius: 8px; min-height: 120px;">
                            ç­‰å¾…ç”Ÿæˆå­¦ä¹ è·¯å¾„...
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h2>æ™ºèƒ½å¯¹è¯</h2>
                    <div class="chat-container" id="teaching-chat">
                        <div class="chat-message chat-assistant">
                            <strong>PEPPER:</strong> ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIæ•™å­¦åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ
                        </div>
                    </div>
                    <div class="form-group" style="display: flex; gap: 10px; margin-top: 15px;">
                        <textarea id="chat-input" rows="2" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." style="flex: 1;"></textarea>
                        <button onclick="sendMessage()" style="width: 80px;">å‘é€</button>
                    </div>

                    <h2>èµ„æºæ¨è</h2>
                    <div class="form-group">
                        <label>æ¨èä¸»é¢˜</label>
                        <select id="recommend-topic">
                            <option value="Pythonç¼–ç¨‹">Pythonç¼–ç¨‹</option>
                            <option value="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</option>
                            <option value="æ•°å­¦">æ•°å­¦</option>
                            <option value="ç‰©ç†">ç‰©ç†</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button onclick="getRecommendations()">è·å–æ¨è</button>
                    </div>
                    <div id="recommendations" style="background: #f8f9ff; padding: 15px; border-radius: 8px; min-height: 100px;">
                        ç­‰å¾…æ¨è...
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>å­¦ä¹ æŠ¥å‘Šç”Ÿæˆ</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>æŠ¥å‘Šç±»å‹</label>
                        <select id="report-type">
                            <option value="progress">å­¦ä¹ è¿›åº¦æŠ¥å‘Š</option>
                            <option value="performance">å­¦ä¹ è¡¨ç°æŠ¥å‘Š</option>
                            <option value="recommendation">å­¦ä¹ å»ºè®®æŠ¥å‘Š</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ—¶é—´èŒƒå›´</label>
                        <select id="time-range">
                            <option value="week">è¿‘ä¸€å‘¨</option>
                            <option value="month">è¿‘ä¸€æœˆ</option>
                            <option value="semester">æœ¬å­¦æœŸ</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button onclick="generateReport()">ç”ŸæˆæŠ¥å‘Š</button>
                    <button class="btn-success" onclick="exportReport()">å¯¼å‡ºæŠ¥å‘Š</button>
                </div>
                <div class="form-group">
                    <label>æŠ¥å‘Šé¢„è§ˆ</label>
                    <div id="report-preview" style="background: #f8f9ff; padding: 20px; border-radius: 8px; min-height: 200px;">
                        ç­‰å¾…ç”ŸæˆæŠ¥å‘Š...
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿæ—¥å¿— -->
        <div class="panel">
            <h2>ç³»ç»Ÿæ—¥å¿—</h2>
            <div class="log-container" id="system-log">
                [ç³»ç»Ÿ] ç­‰å¾…æ“ä½œ...
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentStudent = null;
        let modelLoaded = false;
        let neo4jConnected = false;
        let isRecording = false;
        let discoveredModels = [];
        let selectedModelInfo = null;

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            logMessage('info', `åˆ‡æ¢åˆ°${getTabName(tabName)}é¡µé¢`);
        }

        function getTabName(tabName) {
            const names = {
                'llm': 'å¤§è¯­è¨€æ¨¡å‹',
                'knowledge': 'çŸ¥è¯†å›¾è°±',
                'multimodal': 'å¤šæ¨¡æ€äº¤äº’',
                'teaching': 'æ™ºèƒ½æ•™å­¦'
            };
            return names[tabName] || tabName;
        }

        // æ—¥å¿—è®°å½•
        function logMessage(level, message) {
            const logContainer = document.getElementById('system-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] [${level.toUpperCase()}] ${message}\n`;
            logContainer.textContent += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // APIè°ƒç”¨å‡½æ•°
        async function callAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (data) {
                    if (data instanceof FormData) {
                        delete options.headers['Content-Type'];
                        options.body = data;
                    } else {
                        options.body = JSON.stringify(data);
                    }
                }

                const response = await fetch(`/api/${endpoint}`, options);
                return await response.json();
            } catch (error) {
                logMessage('error', `APIè°ƒç”¨å¤±è´¥: ${error.message}`);
                return { status: 'error', message: error.message };
            }
        }

        // å‘ç°å¯ç”¨æ¨¡å‹
        async function discoverModels() {
            const scanBtn = document.querySelector('.btn-scan');
            const scanStatus = document.getElementById('model-scan-status');

            // æ·»åŠ æ‰«æåŠ¨ç”»
            scanBtn.classList.add('scanning');
            scanBtn.querySelector('.scan-text').textContent = 'æ‰«æä¸­...';

            scanStatus.textContent = 'ğŸ” æ­£åœ¨æ‰«ææ¨¡å‹ç›®å½•...';
            scanStatus.style.borderLeftColor = '#ff9f43';

            logMessage('info', 'å¼€å§‹æ‰«ææ¨¡å‹ç›®å½•');

            const result = await callAPI('discover_models');

            // ç§»é™¤æ‰«æåŠ¨ç”»
            scanBtn.classList.remove('scanning');
            scanBtn.querySelector('.scan-text').textContent = 'æ‰«æ';

            if (result.status === 'success') {
                discoveredModels = result.models;
                updateModelSelector();

                const validCount = result.models.filter(m => m.valid).length;
                scanStatus.innerHTML = `âœ… å‘ç° <strong>${result.count}</strong> ä¸ªæ¨¡å‹ç›®å½•ï¼Œå…¶ä¸­ <strong>${validCount}</strong> ä¸ªæœ‰æ•ˆ`;
                scanStatus.style.borderLeftColor = '#2ed573';

                logMessage('info', `æ¨¡å‹æ‰«æå®Œæˆï¼Œå‘ç° ${result.count} ä¸ªæ¨¡å‹ç›®å½•`);
            } else {
                scanStatus.innerHTML = `âŒ æ‰«æå¤±è´¥: ${result.message}`;
                scanStatus.style.borderLeftColor = '#ff4757';
                logMessage('error', `æ¨¡å‹æ‰«æå¤±è´¥: ${result.message}`);
            }
        }

        // æ›´æ–°æ¨¡å‹é€‰æ‹©å™¨
        function updateModelSelector() {
            const selector = document.getElementById('model-selector');

            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            selector.innerHTML = '<option value="">ğŸ¯ é€‰æ‹©ä¸€ä¸ªæ¨¡å‹...</option>';

            if (discoveredModels.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'ğŸ˜” æœªå‘ç°ä»»ä½•æ¨¡å‹';
                option.disabled = true;
                selector.appendChild(option);
                return;
            }

            // æ·»åŠ å‘ç°çš„æ¨¡å‹
            discoveredModels.forEach(model => {
                const option = document.createElement('option');
                option.value = model.path;

                // è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬å’Œæ ·å¼
                if (model.valid) {
                    option.textContent = `${model.display_name}`;
                    option.style.color = '#2f3542';
                } else {
                    option.textContent = `${model.display_name} (âš ï¸ ä¸å®Œæ•´)`;
                    option.style.color = '#ff6b7a';
                    option.style.fontStyle = 'italic';
                }

                selector.appendChild(option);
            });

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            selector.removeEventListener('change', onModelSelect); // é˜²æ­¢é‡å¤ç»‘å®š
            selector.addEventListener('change', onModelSelect);
        }

        // æ¨¡å‹é€‰æ‹©äº‹ä»¶å¤„ç†
        async function onModelSelect(event) {
            const selectedPath = event.target.value;
            const pathInput = document.getElementById('model-path');
            const detailsDiv = document.getElementById('model-details');
            const loadBtn = document.getElementById('load-model-btn');

            if (selectedPath) {
                // æ›´æ–°è·¯å¾„è¾“å…¥æ¡†
                pathInput.value = selectedPath;

                // æ˜¾ç¤ºæ¨¡å‹è¯¦ç»†ä¿¡æ¯
                await loadModelDetails(selectedPath);
                detailsDiv.style.display = 'block';

                // ç¡®ä¿æŒ‰é’®å¯è§å’Œå¯ç”¨
                loadBtn.style.display = 'inline-block';
                loadBtn.disabled = false;
                loadBtn.textContent = 'åŠ è½½æ¨¡å‹';

                logMessage('info', `å·²é€‰æ‹©æ¨¡å‹: ${selectedPath}`);
            } else {
                // éšè—è¯¦ç»†ä¿¡æ¯
                detailsDiv.style.display = 'none';
                selectedModelInfo = null;
            }
        }

        // åŠ è½½æ¨¡å‹è¯¦ç»†ä¿¡æ¯
        async function loadModelDetails(modelPath) {
            const result = await callAPI('get_model_info', 'POST', { model_path: modelPath });

            if (result.status === 'success') {
                selectedModelInfo = result.model_info;
                displayModelDetails(selectedModelInfo);
            } else {
                logMessage('error', `è·å–æ¨¡å‹ä¿¡æ¯å¤±è´¥: ${result.message}`);
            }
        }

        // æ˜¾ç¤ºæ¨¡å‹è¯¦ç»†ä¿¡æ¯
        function displayModelDetails(modelInfo) {
            // åŸºæœ¬ä¿¡æ¯
            const basicInfo = document.getElementById('model-basic-info');
            basicInfo.innerHTML = `
                <li>åç§°: ${modelInfo.name}</li>
                <li>ç±»å‹: ${modelInfo.model_type || 'æœªçŸ¥'}</li>
                <li>å¤§å°: ${modelInfo.total_size_display}</li>
                <li>è¯æ±‡é‡: ${modelInfo.vocab_size ? modelInfo.vocab_size.toLocaleString() : 'æœªçŸ¥'}</li>
            `;

            // æ–‡ä»¶ç»Ÿè®¡
            const fileStats = document.getElementById('model-file-stats');
            const modelFiles = modelInfo.files.filter(f => f.type === 'model');
            const configFiles = modelInfo.config_files || [];
            const tokenizerFiles = modelInfo.tokenizer_files || [];

            fileStats.innerHTML = `
                <li>æ¨¡å‹æ–‡ä»¶: ${modelFiles.length}</li>
                <li>é…ç½®æ–‡ä»¶: ${configFiles.length}</li>
                <li>åˆ†è¯å™¨æ–‡ä»¶: ${tokenizerFiles.length}</li>
                <li>æ€»æ–‡ä»¶æ•°: ${modelInfo.files.length}</li>
            `;

            // æ–‡ä»¶åˆ—è¡¨
            const filesList = document.getElementById('model-files-list');
            let filesHtml = '';

            // æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º
            const filesByType = {
                'model': modelFiles,
                'config': configFiles,
                'tokenizer': tokenizerFiles,
                'other': modelInfo.files.filter(f => !['model', 'config', 'tokenizer'].includes(f.type))
            };

            Object.entries(filesByType).forEach(([type, files]) => {
                if (files.length > 0) {
                    const typeNames = {
                        'model': 'ğŸ§  æ¨¡å‹æ–‡ä»¶',
                        'config': 'âš™ï¸ é…ç½®æ–‡ä»¶',
                        'tokenizer': 'ğŸ“ åˆ†è¯å™¨æ–‡ä»¶',
                        'other': 'ğŸ“„ å…¶ä»–æ–‡ä»¶'
                    };

                    filesHtml += `<div style="margin-bottom: 10px;">
                        <strong>${typeNames[type]}:</strong><br>`;

                    files.forEach(file => {
                        const sizeText = file.size_mb ? `${file.size_mb} MB` : 'æœªçŸ¥å¤§å°';
                        filesHtml += `<div style="margin-left: 15px; font-size: 12px;">
                            ${file.name} (${sizeText})
                        </div>`;
                    });

                    filesHtml += '</div>';
                }
            });

            filesList.innerHTML = filesHtml || 'æ— æ–‡ä»¶ä¿¡æ¯';
        }

        // ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨HTML
        function generateFilesList(files) {
            if (!files || files.length === 0) {
                return '<div style="text-align: center; color: #999; padding: 20px;">ğŸ“­ æ— æ–‡ä»¶ä¿¡æ¯</div>';
            }

            // æŒ‰ç±»å‹åˆ†ç»„
            const filesByType = {
                'model': files.filter(f => f.type === 'model'),
                'config': files.filter(f => f.type === 'config'),
                'tokenizer': files.filter(f => f.type === 'tokenizer'),
                'other': files.filter(f => !['model', 'config', 'tokenizer'].includes(f.type))
            };

            const typeConfig = {
                'model': { icon: 'ğŸ§ ', name: 'æ¨¡å‹æ–‡ä»¶', color: '#667eea' },
                'config': { icon: 'âš™ï¸', name: 'é…ç½®æ–‡ä»¶', color: '#2ed573' },
                'tokenizer': { icon: 'ğŸ“', name: 'åˆ†è¯å™¨æ–‡ä»¶', color: '#ff9f43' },
                'other': { icon: 'ğŸ“„', name: 'å…¶ä»–æ–‡ä»¶', color: '#a4b0be' }
            };

            let html = '';

            Object.entries(filesByType).forEach(([type, typeFiles]) => {
                if (typeFiles.length > 0) {
                    const config = typeConfig[type];
                    html += `
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600; color: ${config.color};">
                                <span>${config.icon}</span>
                                <span>${config.name} (${typeFiles.length})</span>
                            </div>
                            <div style="margin-left: 20px;">
                    `;

                    typeFiles.forEach(file => {
                        const sizeText = file.size_mb ? `${file.size_mb} MB` : 'æœªçŸ¥å¤§å°';
                        html += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 8px; background: rgba(255,255,255,0.7); border-radius: 4px; margin-bottom: 4px; font-size: 12px;">
                                <span style="font-family: 'Courier New', monospace;">${file.name}</span>
                                <span style="color: #666; font-size: 11px;">${sizeText}</span>
                            </div>
                        `;
                    });

                    html += '</div></div>';
                }
            });

            return html || '<div style="text-align: center; color: #999; padding: 20px;">ğŸ“­ æ— æ–‡ä»¶ä¿¡æ¯</div>';
        }

        // åˆ‡æ¢æ¨¡å‹æ¨¡å¼
        function toggleModelMode() {
            const selectedMode = document.querySelector('input[name="model-mode"]:checked').value;
            const autoSection = document.getElementById('auto-model-section');
            const manualSection = document.getElementById('manual-model-section');
            const detailsDiv = document.getElementById('model-details');

            if (selectedMode === 'auto') {
                autoSection.style.display = 'block';
                manualSection.style.display = 'none';
                logMessage('info', 'åˆ‡æ¢åˆ°è‡ªåŠ¨å‘ç°æ¨¡å¼');
            } else {
                autoSection.style.display = 'none';
                manualSection.style.display = 'block';
                detailsDiv.style.display = 'none';
                logMessage('info', 'åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥æ¨¡å¼');
            }
        }

        // æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯å¯¹è¯æ¡†
        function showModelInfo() {
            if (selectedModelInfo) {
                alert(`æ¨¡å‹ä¿¡æ¯:\nåç§°: ${selectedModelInfo.name}\nè·¯å¾„: ${selectedModelInfo.path}\nå¤§å°: ${selectedModelInfo.total_size_display}\næ–‡ä»¶æ•°: ${selectedModelInfo.files.length}`);
            }
        }

        // å¤§è¯­è¨€æ¨¡å‹åŠŸèƒ½
        async function loadModel() {
            let modelPath;

            if (document.getElementById('manual-path-toggle').checked) {
                modelPath = document.getElementById('model-path').value;
            } else {
                modelPath = document.getElementById('model-selector').value;
            }

            if (!modelPath) {
                alert('è¯·é€‰æ‹©æˆ–è¾“å…¥æ¨¡å‹è·¯å¾„');
                return;
            }

            // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            const loadBtn = document.getElementById('load-model-btn');
            loadBtn.disabled = true;
            loadBtn.textContent = 'æ­£åœ¨åŠ è½½...';

            logMessage('info', `æ­£åœ¨åŠ è½½æ¨¡å‹: ${modelPath}`);

            const result = await callAPI('load_model', 'POST', { model_path: modelPath });

            if (result.status === 'success') {
                modelLoaded = true;
                document.getElementById('model-status').textContent = 'â— æ¨¡å‹å·²åŠ è½½';
                document.getElementById('model-status').className = 'status-indicator status-online';
                loadBtn.textContent = 'âœ“ æ¨¡å‹å·²åŠ è½½';
                loadBtn.style.backgroundColor = '#2ed573';
                logMessage('info', 'æ¨¡å‹åŠ è½½æˆåŠŸ');
            } else {
                // åŠ è½½å¤±è´¥ï¼Œæ¢å¤æŒ‰é’®çŠ¶æ€
                loadBtn.disabled = false;
                loadBtn.textContent = 'åŠ è½½æ¨¡å‹';
                loadBtn.style.backgroundColor = '';
                logMessage('error', `æ¨¡å‹åŠ è½½å¤±è´¥: ${result.message}`);
                alert('æ¨¡å‹åŠ è½½å¤±è´¥: ' + result.message);
            }
        }

        async function unloadModel() {
            const result = await callAPI('unload_model', 'POST');

            if (result.status === 'success') {
                modelLoaded = false;
                document.getElementById('model-status').textContent = 'â— æ¨¡å‹æœªåŠ è½½';
                document.getElementById('model-status').className = 'status-indicator status-offline';

                const loadBtn = document.getElementById('load-model-btn');
                loadBtn.textContent = 'åŠ è½½æ¨¡å‹';
                loadBtn.disabled = false;
                loadBtn.style.backgroundColor = '';

                logMessage('info', 'æ¨¡å‹å·²å¸è½½');
            } else {
                logMessage('error', `æ¨¡å‹å¸è½½å¤±è´¥: ${result.message}`);
            }
        }

        async function testModel() {
            if (!modelLoaded) {
                alert('è¯·å…ˆåŠ è½½æ¨¡å‹');
                return;
            }

            const question = document.getElementById('test-question').value;
            if (!question.trim()) {
                alert('è¯·è¾“å…¥æµ‹è¯•é—®é¢˜');
                return;
            }

            logMessage('info', 'æ­£åœ¨æµ‹è¯•æ¨¡å‹...');

            const result = await callAPI('test_model', 'POST', {
                question: question,
                temperature: parseFloat(document.getElementById('temperature').value),
                max_tokens: parseInt(document.getElementById('max-tokens').value)
            });

            if (result.status === 'success') {
                document.getElementById('model-response').textContent = result.response;
                logMessage('info', 'æ¨¡å‹æµ‹è¯•å®Œæˆ');
            } else {
                logMessage('error', `æ¨¡å‹æµ‹è¯•å¤±è´¥: ${result.message}`);
            }
        }

        async function startFineTuning() {
            const fileInput = document.getElementById('training-data');
            if (!fileInput.files[0]) {
                alert('è¯·å…ˆä¸Šä¼ è®­ç»ƒæ•°æ®');
                return;
            }

            const formData = new FormData();
            formData.append('training_data', fileInput.files[0]);
            formData.append('epochs', document.getElementById('epochs').value);
            formData.append('learning_rate', document.getElementById('learning-rate').value);

            logMessage('info', 'å¼€å§‹LoRAå¾®è°ƒ...');

            const result = await callAPI('start_finetuning', 'POST', formData);

            if (result.status === 'success') {
                logMessage('info', 'LoRAå¾®è°ƒå·²å¼€å§‹');
                updateTrainingProgress();
            } else {
                logMessage('error', `å¾®è°ƒå¯åŠ¨å¤±è´¥: ${result.message}`);
            }
        }

        async function updateTrainingProgress() {
            const result = await callAPI('training_progress');
            if (result.status === 'success') {
                const progress = result.progress;
                document.getElementById('training-progress').style.width = `${progress}%`;
                document.getElementById('progress-text').textContent = `${progress}%`;

                if (progress < 100) {
                    setTimeout(updateTrainingProgress, 2000);
                } else {
                    logMessage('info', 'LoRAå¾®è°ƒå®Œæˆ');
                }
            }
        }

        // çŸ¥è¯†å›¾è°±åŠŸèƒ½
        async function connectNeo4j() {
            const uri = document.getElementById('neo4j-uri').value;
            const user = document.getElementById('neo4j-user').value;
            const password = document.getElementById('neo4j-password').value;

            logMessage('info', 'æ­£åœ¨è¿æ¥Neo4jæ•°æ®åº“...');

            const result = await callAPI('connect_neo4j', 'POST', {
                uri: uri,
                user: user,
                password: password
            });

            if (result.status === 'success') {
                neo4jConnected = true;
                document.getElementById('neo4j-status').textContent = 'â— æ•°æ®åº“å·²è¿æ¥';
                document.getElementById('neo4j-status').className = 'status-indicator status-online';
                logMessage('info', 'Neo4jè¿æ¥æˆåŠŸ');
                updateStats();
            } else {
                logMessage('error', `Neo4jè¿æ¥å¤±è´¥: ${result.message}`);
            }
        }

        async function disconnectNeo4j() {
            const result = await callAPI('disconnect_neo4j', 'POST');
            if (result.status === 'success') {
                neo4jConnected = false;
                document.getElementById('neo4j-status').textContent = 'â— æ•°æ®åº“æœªè¿æ¥';
                document.getElementById('neo4j-status').className = 'status-indicator status-offline';
                logMessage('info', 'Neo4jå·²æ–­å¼€è¿æ¥');
            }
        }

        async function importKnowledge() {
            const fileInput = document.getElementById('knowledge-file');
            if (!fileInput.files[0]) {
                alert('è¯·å…ˆé€‰æ‹©çŸ¥è¯†æ–‡ä»¶');
                return;
            }

            const formData = new FormData();
            formData.append('knowledge_file', fileInput.files[0]);

            logMessage('info', 'æ­£åœ¨å¯¼å…¥çŸ¥è¯†...');

            const result = await callAPI('import_knowledge', 'POST', formData);

            if (result.status === 'success') {
                logMessage('info', `çŸ¥è¯†å¯¼å…¥æˆåŠŸï¼Œå…±å¯¼å…¥${result.count}æ¡çŸ¥è¯†`);
                updateStats();
            } else {
                logMessage('error', `çŸ¥è¯†å¯¼å…¥å¤±è´¥: ${result.message}`);
            }
        }

        async function generateSampleKnowledge() {
            logMessage('info', 'æ­£åœ¨ç”Ÿæˆç¤ºä¾‹çŸ¥è¯†...');

            const result = await callAPI('generate_sample_knowledge', 'POST');

            if (result.status === 'success') {
                logMessage('info', 'ç¤ºä¾‹çŸ¥è¯†ç”ŸæˆæˆåŠŸ');
                updateStats();
            } else {
                logMessage('error', `ç¤ºä¾‹çŸ¥è¯†ç”Ÿæˆå¤±è´¥: ${result.message}`);
            }
        }

        async function executeCypher() {
            if (!neo4jConnected) {
                alert('è¯·å…ˆè¿æ¥Neo4jæ•°æ®åº“');
                return;
            }

            const query = document.getElementById('cypher-query').value;
            if (!query.trim()) {
                alert('è¯·è¾“å…¥CypheræŸ¥è¯¢è¯­å¥');
                return;
            }

            logMessage('info', 'æ­£åœ¨æ‰§è¡ŒCypheræŸ¥è¯¢...');

            const result = await callAPI('execute_cypher', 'POST', { query: query });

            if (result.status === 'success') {
                document.getElementById('query-results').innerHTML =
                    '<pre>' + JSON.stringify(result.data, null, 2) + '</pre>';
                logMessage('info', `æŸ¥è¯¢æˆåŠŸï¼Œè¿”å›${result.data.length}æ¡ç»“æœ`);
            } else {
                logMessage('error', `æŸ¥è¯¢å¤±è´¥: ${result.message}`);
            }
        }

        function clearResults() {
            document.getElementById('query-results').textContent = 'ç­‰å¾…æŸ¥è¯¢...';
        }

        async function updateStats() {
            if (!neo4jConnected) return;

            const result = await callAPI('get_graph_stats');

            if (result.status === 'success') {
                document.getElementById('node-count').textContent = result.stats.nodes;
                document.getElementById('relation-count').textContent = result.stats.relationships;
                document.getElementById('domain-count').textContent = result.stats.domains;
            }
        }

        // å¤šæ¨¡æ€äº¤äº’åŠŸèƒ½
        async function startRecording() {
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    isRecording = true;
                    document.getElementById('record-btn').textContent = 'ğŸ”´ åœæ­¢å½•éŸ³';
                    document.getElementById('speech-status').textContent = 'â— æ­£åœ¨å½•éŸ³';
                    document.getElementById('speech-status').className = 'status-indicator status-online';
                    logMessage('info', 'å¼€å§‹å½•éŸ³');

                    // è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„å½•éŸ³é€»è¾‘

                } catch (error) {
                    logMessage('error', `å½•éŸ³å¤±è´¥: ${error.message}`);
                }
            } else {
                isRecording = false;
                document.getElementById('record-btn').textContent = 'ğŸ¤ å¼€å§‹å½•éŸ³';
                document.getElementById('speech-status').textContent = 'â— è¯­éŸ³è¯†åˆ«æœªå¯åŠ¨';
                document.getElementById('speech-status').className = 'status-indicator status-offline';
                logMessage('info', 'åœæ­¢å½•éŸ³');
            }
        }

        async function uploadAudio() {
            const fileInput = document.getElementById('audio-file');
            if (!fileInput.files[0]) {
                alert('è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                return;
            }

            const formData = new FormData();
            formData.append('audio_file', fileInput.files[0]);

            logMessage('info', 'æ­£åœ¨è¯†åˆ«è¯­éŸ³...');

            const result = await callAPI('recognize_speech', 'POST', formData);

            if (result.status === 'success') {
                document.getElementById('speech-result').textContent = result.text;
                logMessage('info', 'è¯­éŸ³è¯†åˆ«æˆåŠŸ');
            } else {
                logMessage('error', `è¯­éŸ³è¯†åˆ«å¤±è´¥: ${result.message}`);
            }
        }

        async function recognizeImage() {
            const fileInput = document.getElementById('image-file');
            if (!fileInput.files[0]) {
                alert('è¯·å…ˆé€‰æ‹©å›¾åƒæ–‡ä»¶');
                return;
            }

            const formData = new FormData();
            formData.append('image_file', fileInput.files[0]);

            logMessage('info', 'æ­£åœ¨è¯†åˆ«å›¾åƒ...');

            const result = await callAPI('recognize_image', 'POST', formData);

            if (result.status === 'success') {
                document.getElementById('image-result').innerHTML =
                    `<strong>è¯†åˆ«ç»“æœ:</strong> ${result.result.class_name}<br>
                     <strong>ç½®ä¿¡åº¦:</strong> ${(result.result.confidence * 100).toFixed(2)}%`;
                logMessage('info', 'å›¾åƒè¯†åˆ«æˆåŠŸ');
            } else {
                logMessage('error', `å›¾åƒè¯†åˆ«å¤±è´¥: ${result.message}`);
            }
        }

        async function processText() {
            const text = document.getElementById('text-input').value;
            if (!text.trim()) {
                alert('è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬');
                return;
            }

            logMessage('info', 'æ­£åœ¨å¤„ç†æ–‡æœ¬...');

            const result = await callAPI('process_text', 'POST', { text: text });

            if (result.status === 'success') {
                document.getElementById('tokens').textContent = result.tokens.join(', ');
                document.getElementById('keywords').textContent = result.keywords.join(', ');
                document.getElementById('question-type').textContent = result.question_type;
                logMessage('info', 'æ–‡æœ¬å¤„ç†å®Œæˆ');
            } else {
                logMessage('error', `æ–‡æœ¬å¤„ç†å¤±è´¥: ${result.message}`);
            }
        }

        async function extractKeywords() {
            const text = document.getElementById('text-input').value;
            if (!text.trim()) {
                alert('è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬');
                return;
            }

            const result = await callAPI('extract_keywords', 'POST', { text: text });

            if (result.status === 'success') {
                document.getElementById('keywords').textContent = result.keywords.join(', ');
                logMessage('info', 'å…³é”®è¯æå–å®Œæˆ');
            }
        }

        // æ™ºèƒ½æ•™å­¦åŠŸèƒ½
        async function addStudent() {
            const name = document.getElementById('student-name').value;
            const learningStyle = document.getElementById('learning-style').value;

            if (!name.trim()) {
                alert('è¯·è¾“å…¥å­¦ç”Ÿå§“å');
                return;
            }

            const result = await callAPI('add_student', 'POST', {
                name: name,
                learning_style: learningStyle
            });

            if (result.status === 'success') {
                const option = document.createElement('option');
                option.value = result.student_id;
                option.textContent = `${name} (${result.student_id})`;
                document.getElementById('student-select').appendChild(option);

                logMessage('info', `å­¦ç”Ÿ ${name} æ·»åŠ æˆåŠŸ`);

                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('student-name').value = '';
            } else {
                logMessage('error', `æ·»åŠ å­¦ç”Ÿå¤±è´¥: ${result.message}`);
            }
        }

        async function loadStudentProfile() {
            const studentId = document.getElementById('student-select').value;
            if (!studentId) {
                alert('è¯·å…ˆé€‰æ‹©å­¦ç”Ÿ');
                return;
            }

            const result = await callAPI('get_student_profile', 'POST', { student_id: studentId });

            if (result.status === 'success') {
                currentStudent = result.profile;
                logMessage('info', `åŠ è½½å­¦ç”Ÿæ¡£æ¡ˆ: ${result.profile.name}`);
            }
        }

        async function generateLearningPath() {
            const studentId = document.getElementById('student-select').value;
            const goal = document.getElementById('learning-goal').value;

            if (!studentId || !goal.trim()) {
                alert('è¯·é€‰æ‹©å­¦ç”Ÿå¹¶è¾“å…¥å­¦ä¹ ç›®æ ‡');
                return;
            }

            logMessage('info', 'æ­£åœ¨ç”Ÿæˆå­¦ä¹ è·¯å¾„...');

            const result = await callAPI('generate_learning_path', 'POST', {
                student_id: studentId,
                goal: goal
            });

            if (result.status === 'success') {
                document.getElementById('learning-path').innerHTML =
                    result.learning_path.replace(/\n/g, '<br>');
                logMessage('info', 'å­¦ä¹ è·¯å¾„ç”ŸæˆæˆåŠŸ');
            } else {
                logMessage('error', `å­¦ä¹ è·¯å¾„ç”Ÿæˆå¤±è´¥: ${result.message}`);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (!message) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©æ¡†
            const chatContainer = document.getElementById('teaching-chat');
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message chat-user';
            userMsg.innerHTML = `<strong>ä½ :</strong> ${message}`;
            chatContainer.appendChild(userMsg);

            input.value = '';

            // å‘é€åˆ°AIåŠ©æ‰‹
            const result = await callAPI('chat', 'POST', {
                message: message,
                student_id: document.getElementById('student-select').value
            });

            if (result.status === 'success') {
                const assistantMsg = document.createElement('div');
                assistantMsg.className = 'chat-message chat-assistant';
                assistantMsg.innerHTML = `<strong>PEPPER:</strong> ${result.response}`;
                chatContainer.appendChild(assistantMsg);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        async function getRecommendations() {
            const topic = document.getElementById('recommend-topic').value;
            const studentId = document.getElementById('student-select').value;

            logMessage('info', 'æ­£åœ¨è·å–èµ„æºæ¨è...');

            const result = await callAPI('get_recommendations', 'POST', {
                topic: topic,
                student_id: studentId
            });

            if (result.status === 'success') {
                let html = '<h4>æ¨èèµ„æº:</h4><ul>';
                result.resources.forEach(resource => {
                    html += `<li><strong>${resource.title}</strong> (${resource.type})<br>
                            <small>${resource.description}</small></li>`;
                });
                html += '</ul>';
                document.getElementById('recommendations').innerHTML = html;
                logMessage('info', 'èµ„æºæ¨èè·å–æˆåŠŸ');
            }
        }

        async function generateReport() {
            const studentId = document.getElementById('student-select').value;
            const reportType = document.getElementById('report-type').value;
            const timeRange = document.getElementById('time-range').value;

            if (!studentId) {
                alert('è¯·å…ˆé€‰æ‹©å­¦ç”Ÿ');
                return;
            }

            logMessage('info', 'æ­£åœ¨ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š...');

            const result = await callAPI('generate_report', 'POST', {
                student_id: studentId,
                report_type: reportType,
                time_range: timeRange
            });

            if (result.status === 'success') {
                document.getElementById('report-preview').innerHTML = result.report_html;
                logMessage('info', 'å­¦ä¹ æŠ¥å‘Šç”ŸæˆæˆåŠŸ');
            } else {
                logMessage('error', `æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${result.message}`);
            }
        }

        async function exportReport() {
            const reportContent = document.getElementById('report-preview').innerHTML;
            if (!reportContent || reportContent === 'ç­‰å¾…ç”ŸæˆæŠ¥å‘Š...') {
                alert('è¯·å…ˆç”ŸæˆæŠ¥å‘Š');
                return;
            }

            const result = await callAPI('export_report', 'POST', {
                content: reportContent,
                format: 'html'
            });

            if (result.status === 'success') {
                const link = document.createElement('a');
                link.href = result.download_url;
                link.download = result.filename;
                link.click();
                logMessage('info', 'æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ');
            }
        }

        // æ–‡ä»¶ä¸Šä¼ é¢„è§ˆ
        document.getElementById('image-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('preview-image');
                    img.src = e.target.result;
                    img.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // å‚æ•°æ»‘å—æ›´æ–°
        document.getElementById('temperature').addEventListener('input', function(e) {
            document.getElementById('temp-value').textContent = e.target.value;
        });

        // å›è½¦å‘é€æ¶ˆæ¯
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                discoverModels();
            }, 3000);
            logMessage('info', 'ç³»ç»Ÿç•Œé¢åŠ è½½å®Œæˆ');
            // åŠ è½½å­¦ç”Ÿåˆ—è¡¨
            callAPI('get_students').then(result => {
                if (result.status === 'success') {
                    const select = document.getElementById('student-select');
                    result.students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student.id;
                        option.textContent = `${student.name} (${student.id})`;
                        select.appendChild(option);
                    });
                }
            });
        });
    </script>
</body>
</html>